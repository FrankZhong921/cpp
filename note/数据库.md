# SQL

## DQL语言

### 子查询

- 子查询（或内查询）：出现在其它语句中的*select* 语句

- 主查询（或外查询）：相对于子查询的外部查询语句

- 分类

  - **按子查询出现的位置：**

    1. **select后面**：仅仅支持标量子查询

    2. **from后面**：支持表子查询

    3. **where 或 having后面**：支持标量子查询、列子查询、行子查询

       - 特点：

         1. **子查询放在小括号内**
         2. 子查询一般放在条件的右侧
         3. 标量子查询一般搭配**单行操作符，>  <   >=  <=  =  <>**
         4. 列子查询一般搭配**多行操作符，in  any/some  all**

       - 标量子查询

         ``` sql
         select * from employees where salary > (select salary from employees where last_name = 'Amen');
         
         select last_name, job_id, salary from employees where salary =(  select min(salary) from employees);
         
         #查询最低工资大于50号部门最低工资的部门id和其最低工资,having子句也可以子查询
         select min(salary), departmend_id from employees group by department_id having min(salary) > (select min(salary) from employees where department_id = 50);

       - 列子查询

       - 行子查询

    4. **exists后面**（相关子查询）：支持表子查询

       - 只关心子查询中是否有值，查询结果是布尔类型，只有1，0

         ```select exist(select department_id from employees)```

         ```sql
         #查询有员工的部门名
         select department_name from departments d where 
         exist(select * from employees e where e.department_id = d.department_ids);
         
         select department_name from departments where
         department_id in (select department_id from employees );
         ```

         

  - **按结果集的行列数不同：**

    1. 标量子查询（结果集只有一行一列）
    2. 列子查询（结果集只有一列多行）
    3. 行子查询（结果集有一行多列）
    4. 表子查询（结果集一般为多行多列）

  

### 分页查询

- 应用场景：

  淘宝商品页，比如搜索男装，可能有10000条数据，但是并不会将整个10000条商品信息在网页中全部显示出来，而是一次只显示一个页面，当我们点击下一页时，向服务器获取另外10条结果。

- 语法：使用 ***limit*** , offset表示起始索引（从零开始），size表示大小

  ```sql
  select 查询列表			 	  7
  from 表						1
  [join type] join 表2			2
  on 连接条件					  3
  group by 分组字段		      4
  having 分组后的筛选			 5
  order by 排序字段			  6
  limit offset,size; 			 8
  #offset = (page -1) * size
  ```

  - tip：对于得到最大值，最小值不一定需要用max, min，也可以通过排序+limit 1获取

### 联合查询

- union ： 将多条查询的语句的结果合并成一个结果，多表的行合并

- 语法：

  ```sql
  查询语句1
  union
  查询语句2
  union
  ...
  ```

- 应用场景：

  一个网站中多个数据库多个数据表，涉及查多个表，且多个表没有连接关系，将多表的查询结果进行合并。 **合并的前提：每个行的列数必须一致。建议(不报错)每一列对应的类型相同**

- **使用union联合查询默认去重，若不需要去重，使用union all**

## DML语言

数据操作语言：

### 插入

- 语法１：

  ```sql
  insert into 表名（列名......）
  values (值１...),
  (值２...),
  ...
  ```

  - 注：若插入完整行，则表明后面的列名列表可以省略

  - 若某个列字段允许为空，若表名后面的列名没有省略，则对应值为空必须为NULL，若省略了列名，则对应值可以省略．

    ```sql
    #列名列表省略
    insert into beauty
    values ('柳岩','女','121231414');
    #若性别可为空
    insert into beauty (name,phone)
    values ('柳岩','121231414');
    ```

  - 列名列表的顺序可以调换，但是对应值的位置必须一一对应．

- 语法２：

  ```sql
  #无需列名列表的写法
  insert into 表名
  set 列名＝值，列名＝值;
  ```

- 两种语法的比较

  1. **语法１支持一次插入多行**，语法２不支持

  2. **语法１支持子查询**，语法２不支持

     ```sql
     insert into beauty(id,name,phone)
     select 26,'舒淇'，'1551231515';
     #子查询1
     insert into beauty(id,name,phone)
     select id,boyname,'1241512415'
     from boys where id<3;
     
     #一次插入多行
     insert into beauty(id,name,phone)
     select 26,'舒淇','1551231515'
     union
     select 27,'周迅','1552131415';
     ```

     

### 修改

- 修改单表记录

  - 语法：

    ```sql
    update 表名
    set 列＝值,
    列＝值，
    ...
    where 条件
    ```

    

- 修改多表记录（级联修改）

  - 语法：

    ```sql
    update 表１　别名
    inner|left|right join 表２ 别名
    on 连接条件
    set 列＝值，列＝值,...
    where 筛选条件
    ```

  - ```SQL
    update boys bo
    inner join beauty b on bo.id = b.boyfriend_id
    set b.phone = '114'
    where bo.boyName = 'ASDA';		
    ```

    

### 删除

- 方法１：**delete**

  - 单表删除语法：

    ```sql
    delete from 表名　where 筛选条件;	
    ```

  - 多表删除语法：

    ```sql
    delete 别名1...(别名２)(别名１，别名２)
    from 表１　别名１
    inner | left|right join 表２　别名２
    on 连接条件
    where 筛选条件
    ```

    **注：要删除那个表中对应的记录，取决与delete后面的别名是那个表**

- 方法２：truncate

  - 语法：

    ```sql
    #整个表清空，不能加条件
    truncate table 表名;
    ```

- 方法１vs方法２

  1. delete 可以加where条件，truncate不能加条件;
  2. truncate删除，效率较高
  3. 假如要剔除的表中有自增长列，如果使用delete剔除后，再插入数据，自增长列的值从断点开始，而truncate剔除后，再插入数据．自增长列的值从１开始
  4. truncate删除没有返回值，delete删除有返回值．
  5. truncate删除不能回滚，delete删除可以回滚

## 理论

